# AI Uncertainty-Aware Energy Orchestrator

Система для прогнозування та оптимізації енергосистеми України з урахуванням невизначеності та ризиків.

## Джерела даних

1. **Дані про тривоги** - зпаршено із сайту https://alerts.in.ua/?showThreats&showWarnings
2. **Дані про вимикання по регіонам** - із https://energy-map.info/uk
3. **Дані про навантаження** - із KAGGLE

## Архітектура системи

Система складається з трьох основних компонентів:

1. **GNN Agent (Graph Neural Network)** - прогнозує ризики для регіонів та підстанцій на основі графа енергосистеми, історичних даних про тривоги, відключення та погодних умов
2. **Load Agent** - прогнозує навантаження (demand) та генерацію електроенергії на 24 години вперед з урахуванням погодних умов та тривог
3. **Orchestrator** - координує роботу агентів, приймає рішення про розподіл ресурсів та оптимізацію енергосистеми

### Потік даних:
```
Зовнішні джерела → Парсинг → Підготовка даних → Навчання моделей → Прогнозування → Оркестрація → Рішення
```

## Структура проєкту та порядок використання

### Етап 1: Збір та підготовка даних

#### `utils/alerts_parser.py`
**Призначення:** Парсить дані про повітряні тривоги з сайту alerts.in.ua  
**Що робить:**
- Автоматично завантажує CSV файли з тривогами за вказаний період
- Зберігає файли в `data/alerts/`

**Порядок виконання:** Запустіть першим для збору історичних даних про тривоги


#### `utils/prepare_alerts.py`
**Призначення:** Обробляє та об'єднує CSV файли з тривогами  
**Що робить:**
- Об'єднує всі CSV файли з папки `data/alerts/` в один файл
- Фільтрує тільки завершені тривоги (з датою закінчення)
- Сортує за датою та зберігає в `data/alerts_merged_sorted.csv`

**Порядок виконання:** Запустіть після `alerts_parser.py`

### Етап 2: Підготовка даних для GNN моделі

#### `GNN_AGENT.ipynb`
**Призначення:** Підготовка даних та навчання GNN моделі для прогнозування ризиків  
**Що робить:**
- Завантажує дані про відключення електроенергії (`data/2025_10_14_elektro_boiovi_dii_oblasti_osr.csv`)
- Завантажує дані про тривоги (`data/alerts_merged_sorted.csv`)
- Створює граф енергосистеми (регіони + підстанції)
- Завантажує погодні дані через Open-Meteo API
- Об'єднує всі дані в один датасет
- Навчає TemporalGAT (Temporal Graph Attention Network) модель
- Зберігає модель в `serialized/risk_gnn_model.pt` та скейлер в `serialized/risk_gnn_scaler.pkl`

**Порядок виконання:** Запустіть після підготовки даних про тривоги


### Етап 3: Підготовка даних для Load Agent

#### `LOAD_AGENT_PREPARE.ipynb`
**Призначення:** Підготовка даних для моделі прогнозування навантаження  
**Що робить:**
- Завантажує дані про споживання та генерацію електроенергії (з KAGGLE)
- Мапить регіони США до регіонів України
- Завантажує погодні дані для регіонів США
- Розширює дані на регіони України з урахуванням масштабування
- Об'єднує з даними про тривоги (погодинно)
- Імітує вплив тривог та пошкоджень на генерацію та споживання
- Зберігає підготовлений датасет в `data/ready2use_region_electricity.csv`

**Порядок виконання:** Запустіть після `GNN_AGENT.ipynb` (або паралельно)


### Етап 4: Навчання Load Agent

#### `LOAD_AGENT_TRAIN.ipynb`
**Призначення:** Навчання моделі прогнозування навантаження на 24 години вперед  
**Що робить:**
- Завантажує підготовлений датасет з `data/ready2use_region_electricity.csv`
- Створює циклічні ознаки часу (sin/cos для години доби)
- Навчає GRU модель (LoadGRU) для прогнозування `energy_deficit_adj` на 24 години вперед
- Використовує контекстне вікно 7 днів (168 годин)
- Зберігає навчену модель та скейлер

**Порядок виконання:** Запустіть після `LOAD_AGENT_PREPARE.ipynb`


### Етап 5: Оркестрація та прийняття рішень

#### `orchestrator.ipynb`
**Призначення:** Координує роботу GNN та Load агентів, приймає рішення про розподіл ресурсів  
**Що робить:**
- Завантажує навчені моделі (GNN та Load)
- Отримує прогнози від обох агентів
- Аналізує ризики та прогнози навантаження
- Приймає рішення про оптимізацію енергосистеми

**Порядок виконання:** Запустіть після навчання обох моделей


#### `agent.ipynb`
**Призначення:** LangGraph агент для інтелектуального прийняття рішень  
**Що робить:**
- Використовує LangGraph для побудови графа прийняття рішень
- Інтегрується з OpenAI API для аналізу ситуації
- Валідує дані, оцінює ризики, приймає рішення

**Порядок виконання:** Може використовуватися разом з `orchestrator.ipynb` або окремо


### Конфігурація

#### `api_config.py`
**Призначення:** Конфігурація API ключів та налаштувань  
**Що робить:**
- Завантажує змінні середовища з `.env` файлу
- Надає функції для отримання OpenAI клієнта
- Перевіряє наявність необхідних API ключів


### Серіалізовані моделі

#### `serialized/risk_gnn_model.pt`
Навчена GNN модель для прогнозування ризиків

#### `serialized/risk_gnn_scaler.pkl`
Скейлер для нормалізації ознак GNN моделі



## Порядок використання

1. **Встановіть залежності:**
   ```bash
   pip install -r requirements.txt
   playwright install
   ```

2. **Налаштуйте змінні середовища:**
   Створіть файл `.env` з необхідними API ключами (див. `api_config.py`)

3. **Зберіть дані:**
   ```bash
   python utils/alerts_parser.py
   python utils/prepare_alerts.py
   ```

4. **Підготуйте та навчіть моделі:**
   - Запустіть `GNN_AGENT.ipynb` (повністю)
   - Запустіть `LOAD_AGENT_PREPARE.ipynb` та `LOAD_AGENT_TRAIN.ipynb`

5. **Використовуйте систему:**
   - Запустіть `orchestrator.ipynb` для прогнозування та оптимізації


## Примітки

- Всі дані зберігаються в папці `data/`
- Навчені моделі зберігаються в папці `serialized/`
- Для роботи з погодними даними використовується Open-Meteo API
- Система використовує проксі для обходу rate limits API
